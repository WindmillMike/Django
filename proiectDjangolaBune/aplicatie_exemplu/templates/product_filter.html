<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>Filtrare Produse</title>
    //Bonus
    <script>
    // Când pagina s-a încărcat complet, executăm codul de mai jos
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("product-filter-form");  // Selectăm formularul după ID
        
        form.addEventListener("submit", function (event) {
            event.preventDefault();  // Previne reîncărcarea paginii la trimiterea formularului
            
            const formData = new FormData(form);  // Creăm un obiect FormData pentru a colecta datele introduse
            
            fetch(form.action, {  // Facem un request către URL-ul din atributul "action" al formularului
                method: "GET",  // Folosim metoda GET pentru a trimite datele
                headers: { "X-Requested-With": "XMLHttpRequest" },  // Setăm header-ul pentru a indica un request AJAX
                body: new URLSearchParams(formData)  // Convertim datele formularului într-un format compatibil cu URL
            })
            .then(response => response.json())  // Parsăm răspunsul ca JSON
            .then(data => {
                const productList = document.getElementById("product-list");  // Selectăm lista unde vor fi afișate produsele
                productList.innerHTML = "";  // Ștergem conținutul listei pentru a adăuga datele noi
                
                data.products.forEach(product => {  // Parcurgem lista de produse primită din JSON
                    productList.innerHTML += `<li>${product.name} - ${product.price} - ${product.stock_quantity} - ${product.category__name}</li>`;  // Adăugăm fiecare produs în listă
                });
            })
            .catch(error => console.error("Eroare AJAX:", error));  // Prindem eventualele erori și le afișăm în consolă
        });
    });
    </script>
</head>
<body>
    <h1>Filtrare Produse</h1>
    
    <!-- Formularul pentru filtrarea produselor -->
    <form id="product-filter-form" method="GET" action="{% url 'filter_products' %}">
        {{ form.as_p }}  <!-- Django generează câmpurile formularului aici -->
        <button type="submit">Filtrează</button>  <!-- Buton pentru a trimite formularul -->
    </form>

    <h2>Rezultate</h2>
    
    <!-- Lista unde vor fi afișate produsele filtrate -->
    <ul id="product-list">
        {% for product in products %}  <!-- Parcurgem produsele primite din view și le afișăm -->
            <li>{{ product.name }} - {{ product.price }} - {{ product.stock_quantity }} - {{ product.category.name }}</li>
        {% endfor %}
    </ul>
</body>
</html>
